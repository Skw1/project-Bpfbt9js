{"version":3,"file":"commonHelpers.js","sources":["../src/js/totalcartsum.js","../src/js/cart.js"],"sourcesContent":["import refsAPI from './refs.js';\nimport fetchApi from './fetchApi.js';\nimport localStorageApi from './localStorageApi.js';\nimport closeIcon from '../img/icons.svg#close-icon';\nimport { drawHeaderCartNumber } from './discount.js';\nimport ModalFilter from './modal/ModalFilter.js';\n\nasync function totalCartSum() {\n  let cartIsEmpty = true;\n  const frontEnd = new refsAPI();\n  console.log(frontEnd);\n  frontEnd.bigCartNumber.textContent = 'CART (0)';\n  var productsToDraw = [];\n  var cartSum = 0;\n  //load cart with products\n  const cart = localStorageApi.loadCart();\n\n  //get  info for each product in cart\n  if ('products' in cart) {\n    const products = await Promise.all(\n      cart.products.map(product => {\n        return fetchApi.product(product.productId);\n      })\n    );\n    products.forEach(product => {\n      cartIsEmpty = false;\n      //add totall product price to totall cart sum\n      cartSum =\n        cartSum +\n        product.price * cart.products[products.indexOf(product)].amount;\n      // console.log(typeof cart.products[products.indexOf(product)].amount);\n      productsToDraw.push(`\n            \n            <li class=\"cart-product\" data-productId=\"${product._id}\">\n            <div class=\"cart-product-img\">\n              <img class=\"card-img\"\n                src=\"${product.img}\"\n                alt=\"${product.name}\"\n              />\n            </div>\n\n            <div class=\"cart-product-card\">\n            <div class=\"cart-product-name-container\">\n              <h3 class=\"cart-product-name\">${product.name}</h3>\n              <button data-productId=\"${product._id}\" type=\"button\" class=\"cart-product-delete-btn js-cart-prod-del\">\n              <svg class=\"cart-icon-close\" width=\"18\" height=\"18\">\n                    <use href=\"${closeIcon}\"></use>\n                    </svg>\n              </button>\n            </div>\n\n            <div class=\"cart-product-info\">\n                  <p class=\"cart-category-title\">\n                    Category:\n                    <span class=\"cart-category-name\">${product.category}</span>\n                  </p>\n                  <p class=\"cart-product-size\">\n                    Size: <span class=\"cart-product-size-value\">${product.size}</span>\n                  </p>\n                  <p class=\"cart-product-price\">$${product.price}</p>\n            </div>\n          </li>\n          `);\n    });\n    frontEnd.bigCartNumber.textContent = 'CART (' + cart.products.length + ')';\n  }\n  if (cartIsEmpty) {\n    frontEnd.deleteAllBtn.style.display = 'none';\n    frontEnd.cartEmptyContainer.style.display = 'block';\n    frontEnd.totalCartSum.textContent = 'Sum: $0';\n    frontEnd.cartContainer.innerHTML = '';\n  } else {\n    frontEnd.deleteAllBtn.style.display = 'block';\n    frontEnd.cartEmptyContainer.style.display = 'none';\n    frontEnd.cartContainer.innerHTML = productsToDraw.join('');\n    frontEnd.totalCartSum.textContent = 'Sum: $' + cartSum.toFixed(2);\n  }\n\n  // delete one product\n  if ('products' in cart && cart.products.length) {\n    document\n      .querySelector('.js-cart-prod-del')\n      .addEventListener('click', event => {\n        const frontEnd = new refsAPI();\n        const btn = event.target.closest('.js-cart-prod-del');\n        const id = btn.dataset.productid;\n\n        const prodIdx = cart.products.findIndex(\n          product => product.productId === id\n        );\n        if (prodIdx !== -1) {\n          cart.products.splice(prodIdx, 1);\n        }\n\n        localStorageApi.saveCart(cart);\n        totalCartSum();\n        console.log(frontEnd);\n        frontEnd.cartEmptyContainer.style.display = 'block';\n      });\n  }\n}\n\nasync function checkout(event) {\n  event.preventDefault();\n  const frondEnd = new refsAPI();\n  const cart = localStorageApi.loadCart();\n  if (frondEnd.cartEmail.value.trim().length !== 0) {\n    if ('products' in cart) {\n      if (cart.products.length !== 0) {\n        try {\n          cart.email = frondEnd.cartEmail.value.trim();\n          const message = await fetchApi.order(cart);\n          localStorageApi.deleteCart();\n          drawHeaderCartNumber();\n          totalCartSum();\n          ModalFilter._modalImg.style.display = 'none';\n          ModalFilter._modal.innerHTML = `\n        <div class=\"modal-inner\">\n          <img\n            class=\"modal__food-tomatto\"\n            src=\"../img/tomatto.png\"\n            alt=\"Кошик з фруктамі\"\n          />\n          <div class=\"modal__title--wrap-success\">\n            <p class=\"modal__title--success\">ORDER SUCCESS</p>\n          </div>\n          <div class=\"modal__description--wrap modal__description--wrap-success\">\n            <p class=\"modal__description modal__description--success\">\n              Thank you for shopping at Food Boutique. Your order has been\n              received and is now being freshly prepared just for you! Get ready\n              to indulge in nourishing goodness, delivered right to your doorstep.\n              We're thrilled to be part of your journey to better health and\n              happiness.\n            </p>\n          </div>\n        </div>`;\n          ModalFilter.open();\n        } catch (error) {\n          alert('Check email!');\n        }\n      } else {\n        alert('empty cart2!');\n      }\n    } else {\n      alert('empty cart1!');\n    }\n  } else {\n    alert('empty email!');\n  }\n}\n\nexport { totalCartSum, checkout };\n","import localStorageApi from './localStorageApi.js';\nimport { form } from '/js/footer-modal.js';\nimport { postEmail } from '/js/footer-modal.js';\n\nimport { totalCartSum, checkout } from './totalcartsum.js';\nimport { drawHeaderCartNumber } from './discount.js';\nimport refsAPI from './refs.js';\n\ndrawHeaderCartNumber();\ntotalCartSum();\n\nconst frondEnd = new refsAPI();\n\nfrondEnd.buttonCheckout.addEventListener('click', checkout);\n\nform.addEventListener('submit', postEmail);\n\n// delete all cart\nfrondEnd.deleteAllBtn.addEventListener('click', event => {\n  console.log(event.target.classList.contains('js-delete-all'));\n  if (event.target.classList.contains('js-delete-all')) {\n    localStorageApi.deleteCart();\n    totalCartSum();\n  }\n});\n"],"names":["totalCartSum","cartIsEmpty","frontEnd","refsAPI","productsToDraw","cartSum","cart","localStorageApi","products","product","fetchApi","closeIcon","event","id","prodIdx","checkout","frondEnd","message","drawHeaderCartNumber","ModalFilter","form","postEmail"],"mappings":"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"}